<div class="content-wrapper-top">
  <div class="content-container padding">
    <div class="text-center">
      <h3>Template</h3>
    </div>
    <div class="text-center creating">
      <mat-form-field>
        <mat-label>Template</mat-label>
        <mat-select
          name="template"
          [(ngModel)]="selectedTemplate"
          (ngModelChange)="UpdateSelected()"
        >
          @for (template of this.templateService.templates$ | async ; track
          template) {
          <mat-option [value]="template">{{
            template.templateName
          }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <div *ngIf="this.authService.user" class="inline">
        <mat-icon
          fontIcon="add"
          class="icon add-icon"
          matTooltip="Add new template"
          (click)="OpenAddTemplateDialog()"
        ></mat-icon>
        <mat-icon
          fontIcon="remove"
          class="icon remove-icon"
          matTooltip="Remove current template"
          (click)="OpenDeleteTemplateDialog()"
          *ngIf="!this.selectedTemplate.isDefault"
        ></mat-icon>
      </div>
    </div>

    <mat-divider></mat-divider>
    <h3 class="text-center mt-1">General Settings</h3>
    <div class="settings-container" *ngIf="this.selectedTemplate; let template">
      <setting-input
        *ngIf="template.GetKeySetting('pomodoro'); let setting"
        settingName="Pomodoro time"
        [setting]="setting"
        (valueChange)="this.UpdateSetting($event)"
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />
      <setting-input
        *ngIf="template.GetKeySetting('shortBreak'); let setting"
        settingName="Short break time"
        [setting]="setting"
        (valueChange)="this.UpdateSetting($event)"
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />

      <setting-input
        *ngIf="template.GetKeySetting('longBreak'); let setting"
        settingName="Long break time"
        [setting]="setting"
        (valueChange)="this.UpdateSetting($event)"
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />

      <setting-input
        *ngIf="template.GetKeySetting('sessionBeforeLongBreak'); let setting"
        settingName="Sessions Before Long Break"
        [minValue]="1"
        [maxValue]="10"
        [setting]="setting"
        (valueChange)="this.UpdateSetting($event)"
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />

      <setting-input
        *ngIf="template.GetKeySetting('breakAutostart'); let setting"
        settingName="Break autostart"
        type="toggle"
        [setting]="setting"
        (valueChange)="this.UpdateSetting($event)"
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />

      <setting-input
        *ngIf="template.GetKeySetting('pomodoroAutostart'); let setting"
        settingName="Pomodoro autostart"
        type="toggle"
        [setting]="setting"
        (valueChange)="this.UpdateSetting($event)"
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />
    </div>

    <mat-divider></mat-divider>
    <h3 class="text-center mt-1">Alarm</h3>
    <div class="text-center creating">
      <mat-form-field>
        <mat-label>Alarm</mat-label>
        <mat-select name="alarm" [(ngModel)]="selectedAlarm">
          @for (alarm of this.alarmService.alarms$ | async ; track alarm) {
          <mat-option [value]="alarm">{{ alarm.name }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <div *ngIf="this.authService.user" class="inline">
        <mat-icon
          fontIcon="add"
          class="icon add-icon"
          matTooltip="add new alarm"
          (click)="OpenAddAlarmDialog()"
        ></mat-icon>
        <mat-icon
          fontIcon="remove"
          class="icon remove-icon"
          matTooltip="remove alarm"
          (click)="OpenRemoveAlarmDialog()"
          *ngIf="!this.selectedAlarm.isDefault"
        ></mat-icon>
      </div>
    </div>
    <mat-divider></mat-divider>
    <h3 class="text-center mt-1">Template Alarm Settings</h3>
    <div class="flex-center mt-1">
      <button mat-raised-button color="primary" (click)="this.alarmService.StopPlaying()">Stop Playing Alarm</button>
    </div>
    <div class="settings-container" *ngIf="this.selectedTemplate; let template">
      <setting-input
        *ngIf="template.GetKeySetting('pomodoroAlert'); let setting"
        settingName="Pomodoro Alert"
        type="list-id"
        label="Select Alert"
        [listItems]="alarmItemList$"
        [setting]="setting"
        (valueChange)="
          this.UpdateSetting($event);
          this.alarmService.PlayAlarmID(
            template.GetKeySetting('pomodoroAlert')!.value,
            template.GetKeySetting('pomodoroAlertVolume')!.value
          )
        "
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />
      <setting-input
        *ngIf="template.GetKeySetting('pomodoroAlertVolume'); let setting"
        settingName="Pomodoro Alert Volume"
        type="slider"
        [setting]="setting"
        (valueChange)="
          this.UpdateSetting($event);
          this.alarmService.PlayAlarmID(
            template.GetKeySetting('pomodoroAlert')!.value,
            template.GetKeySetting('pomodoroAlertVolume')!.value
          )
        "
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />

      <setting-input
        *ngIf="template.GetKeySetting('breakAlert'); let setting"
        settingName="Break Alert"
        type="list-id"
        label="Select Alert"
        [listItems]="alarmItemList$"
        [setting]="setting"
        (valueChange)="
          this.UpdateSetting($event);
          this.alarmService.PlayAlarmID(
            template.GetKeySetting('breakAlert')!.value,
            template.GetKeySetting('breakAlertVolume')!.value
          )
        "
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />
      <setting-input
        *ngIf="template.GetKeySetting('breakAlertVolume'); let setting"
        settingName="Break Alert Volume"
        type="slider"
        [setting]="setting"
        (valueChange)="
          this.UpdateSetting($event);
          this.alarmService.PlayAlarmID(
            template.GetKeySetting('breakAlert')!.value,
            template.GetKeySetting('breakAlertVolume')!.value
          )
        "
        (boundChange)="this.SetBinding($event)"
        [isDefault]="template.isDefault"
        [binding]="this.GetBound(setting)"
      />
    </div>
  </div>
</div>
